<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Accepted Works | HarVyakti</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; font-family:'Segoe UI',Tahoma,sans-serif; min-height:100vh; display:flex; flex-direction:column; }
header { position:fixed; top:0; left:0; width:100%; background:linear-gradient(90deg,#4facfe,#00f2fe); box-shadow:0 4px 8px rgba(0,0,0,.2); z-index:1000; }
.header-container { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding:15px 20px; }
.logo { font-size:1.8rem; font-weight:bold; color:white; cursor:pointer; letter-spacing:1px; }
nav a { color:white; text-decoration:none; margin-left:25px; font-weight:600; }
h2{text-align:center; margin-top:100px;}
.work-card{background:#fff; padding:15px; margin:15px auto; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1); max-width:600px; text-align:left;}
button{padding:8px 12px; background:#1976d2; color:#fff; border:none; border-radius:5px; cursor:pointer; margin-top:10px;}
button:disabled{background:#aaa;}
.empty{text-align:center; color:#666; margin-top:40px;}

.status-badge{
  padding:4px 8px;
  border-radius:4px;
  color:#fff;
  font-weight:600;
}
.status-completed{
  background:#2e7d32; /* green */
}
.status-other{
  background:#1976d2;
}
.rating-stars{
  color:#fbc02d;
  font-size:1.1rem;
  font-weight:600;
}

</style>

</style>
</head>
<body>

<header>
<div class="header-container">
  <div class="logo">HarVyakti</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="dashboard.html">Dashboard</a>
  </nav>
</div>
</header>

<h2>Works You Accepted</h2>
<div id="acceptedWorksContainer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// üîπ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDT4XZtLbYRsSwM5doqkjMANf2d6oWLCuE",
  authDomain: "harvyakti.firebaseapp.com",
  projectId: "harvyakti",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const acceptedWorksContainer = document.getElementById("acceptedWorksContainer");
let currentUser = null;

// üîê Auth check
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }
  currentUser = user;
  loadAcceptedWorks();
});

// üì• Load accepted works
async function loadAcceptedWorks() {
  acceptedWorksContainer.innerHTML = "Loading...";

  try {
    const q = query(
      collection(db, "works"),
      where("acceptedBy", "==", currentUser.uid)
    );

    const snap = await getDocs(q);
    acceptedWorksContainer.innerHTML = "";

    if (snap.empty) {
      acceptedWorksContainer.innerHTML =
        '<div class="empty">You have not accepted any works yet</div>';
      return;
    }

    for (const d of snap.docs) {
      const w = d.data();
      const div = document.createElement("div");
      div.className = "work-card";

      // üë§ Fetch requester info
      let requesterName = "Unknown";
      let requesterMobile = "N/A";

      try {
        const requesterSnap = await getDoc(doc(db, "users", w.postedBy));
        if (requesterSnap.exists()) {
          const data = requesterSnap.data();
          requesterName = data.name || "Unknown";
          requesterMobile = data.mobile || "N/A";
        }
      } catch (e) {
        console.error("Requester fetch error:", e);
      }

      const isCompleted = w.status === "completed";
const rating = w.rating || null;


      // üß© HTML
     div.innerHTML = `
  <h3>${w.title}</h3>
  <p>${w.description}</p>
  <p><b>Amount:</b> ‚Çπ${w.amount}</p>
  <p><b>Requester:</b> ${requesterName}</p>

  ${
    isCompleted
      ? `<p><b>Mobile:</b> Hidden after completion</p>`
      : `<p><b>Mobile:</b> ${requesterMobile}
          <a href="tel:${requesterMobile}">
            <button>Call</button>
          </a>
        </p>`
  }

  ${
    rating
      ? `<p><b>Rating Given:</b> 
           <span class="rating-stars">
             ${"‚≠ê".repeat(rating)} (${rating}/5)
           </span>
         </p>`
      : `<p><b>Rating:</b> Not given yet</p>`
  }

  <p>
    <b>Status:</b>
    <span class="status-badge ${isCompleted ? "status-completed" : "status-other"}">
      ${w.status}
    </span>
  </p>
`;


      acceptedWorksContainer.appendChild(div);
    }
  } catch (err) {
    console.error(err);
    acceptedWorksContainer.innerHTML = "Error loading accepted works";
  }
}
</script>


<footer style="margin-top:auto; text-align:center; padding:15px 0; background:#1c1c1c; color:#fff;">
&copy; 2025 HarVyakti. All rights reserved.
</footer>

</body>
</html>
